---
name: docker study template
about: Describe this issue template's purpose here.
title: "헬스 체크와 디펜던시 체크로 애플리케이션의 신뢰성 확보하기"
labels: "docker"
assignees: "yang"
---

### 📌 1. 정리

#### 헬스 체크

- Dockerfile의 HEALTHCHECK 인스트럭션을 통해 구현
- 단순 프로세스 존재 여부가 아닌 실제 애플리케이션의 기능 상태 확인
- 지정된 시간 간격으로 명령을 수행하여 애플리케이션 상태 판단
- 기본값: 30초 간격으로 연속 3회 이상 실패 시 이상 상태로 판단
- 도커는 이상 상태를 감지하면 사용자에게 알리는 역할만 수행

#### 디펜던시 체크

- 분산 애플리케이션에서 컨테이너 간 의존 관계 관리
- 한 애플리케이션의 정상 작동이 다른 애플리케이션의 준비 상태에 의존
- 단일 서버에서는 도커가 컨테이너 실행 순서 직접 관리 가능
- 클러스터 환경에서는 여러 서버가 동시에 동작하여 순차적 실행 보장 어려움
- Docker Compose의 depends_on은 단순히 컨테이너 시작 순서만 보장

### 커스텀 유틸리티 활용

- 실무에서는 보안 정책상 curl 등의 도구 대신 커스텀 유틸리티 사용 권장
- 애플리케이션과 동일한 언어로 구현된 유틸리티 사용의 장점:
  - 추가 소프트웨어 없이 실행 가능
  - 복잡한 체크 로직 구현 가능
  - 설정 재사용으로 일관성 유지
  - 다양한 체크 수행 가능
  - 이미지의 이식성 향상

#### 주의 사항

- 헬스 체크는 주기적으로 실행되므로 시스템 부하가 적은 테스트 권장
- 애플리케이션의 핵심 기능만 체크하는 것이 중요
- 디펜던시 체크는 시작 시에만 실행되므로 상대적으로 리소스 소모에 덜 민감

---

### 🚀 2. 어려운 점 OR 공유할 점

- 커스텀 유틸리티는 뭐 만드는건가,,?

---

### 🔍 3. 문제 풀이 공유

#### **📌 문제 설명**

- 애플리케이션 시작 시 충분한 메모리가 있는지 확인하고, 메모리가 부족한 경우 컨테이너를 종료
- 애플리케이션 실행 중 5초 간격으로 최대치를 초과해 메모리를 사용하는지 확인.
- 최대치를 초과했다면 해당 컨테이너의 상태를 이상으로 판정해야함

#### **📌 코드 & 풀이 과정**

```bash
1. lab/ 하위의 memory-check.js , memory-hug.js 발견
2. memeroy-check.js는 메모리를 보고 특정 메모리가 넘어가면 1반환
3. memory-hub.js는 메모르를 늘리는?
4. 컨테이너 시작하며 memory-check와 memory-hug 실행
5. HEALTHCHECK --interval=5s 와 함께 memory-check
6. 빌드 후 실행 -> 특정 시점 넘어가니 unhealthy

```

---

### 📝 4. 내가 내는 문제

#### 1. docker image에 curl를 포함시키는 것이 위험한 이유는?

<details>
<summary>정답</summary>

1. 보안 문제

- curl은 네트워크 요청을 보내는 도구로, 잘못된 사용 시 보안 취약점 노출 가능
- HEALTHCHECK는 컨테이너 내부에서 실행되어 공격자가 이를 악용할 위험 존재
  - 컨테이너 데이터 유출 위험
  - 악의적인 공격 가능성

2. 안정성 이슈

- curl을 이용한 HEALTHCHECK는 외부 요인에 취약
  - 네트워크 상태 영향
  - 타 서비스의 응답 속도 의존
- 서비스 정상 작동 중에도 HEALTHCHECK 실패 가능성 존재

3. 이미지 크기 문제

- curl 포함으로 인한 불필요한 이미지 크기 증가
- 복잡한 다중 레이어 이미지에서 특히 문제될 수 있음
- 모든 이미지에 curl이 필수적이지 않아 자원 낭비 발생
</details>

#### 2. Docker 컨테이너의 HEALTHCHECK에서 스크립트가 종료 코드 0을 반환하면 어떤 상태인가?

<details>
<summary>정답</summary>

- 정답: healthy

- 설명:
  - HEALTHCHECK 스크립트가 종료 코드 0을 반환하면 컨테이너는 'healthy' 상태로 간주됨
  - 이는 컨테이너가 정상적으로 작동하고 있음을 의미
  - 0이 아닌 종료 코드를 반환하면 'unhealthy' 상태로 전환됨
  - 'starting'은 초기 상태이며, 'exited'는 컨테이너가 종료된 상태를 의미
  </details>
